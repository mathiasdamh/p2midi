<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>WebMusic - P2</h1>
    </header>
    <div class="topnav">
        <a href="index.html">Home</a>
        <a href="indspilning.html">Recording</a>
        <a class="active" href="download.html">Download</a>
        <a href="upload.html">Upload</a>
        <a href="afspilning.html">Playing</a>
        <a href="redigering.html">Edit</a>
        <a href="sammensaetning.html">Composition</a>
        <a href="om.html">About</a>
        <a href="login.html">Login</a>
        <div class="search-container">
          <form action="server.js">
            <input type="text" placeholder="Search.." name="search">
            <button type="submit">Submit</button>
          </form>
        </div>
    </div>
    <h2>Download all the MIDI files you want! You can find them below</h2>
    <h3>Genre tags:</h3>
    <div class="tagWrapper">
        <a href="#" class="tag">Pop</a>
        <a href="#" class="tag">Rock</a>
        <a href="#" class="tag">Jazz</a>
        <a href="#" class="tag">Smooth</a>
    </div>
    <div id="body">
        <ul id="midiFiles">
        </ul>
    </div>
<script type="text/javascript">
let liClass = "liClass";

function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.innerHTML = filename;

    document.getElementById('body').appendChild(element);

}

function downloadMidi(filename) {
    var element = document.createElement('a');
    let path = "SavedFiles/midi/"+filename+".mid";

    element.setAttribute('href', path);
    element.setAttribute('download', filename+".mid");
    element.innerHTML = filename;

    document.getElementById('body').appendChild(element);

}

async function displayFiles(){
    const res = await fetch("midiFilesDir",{
        method:"POST"
    })
    const data = await res.text();
    let fileDir = JSON.parse(data);

    let element;
    let dlPath;

    for (let i = 0; i < fileDir.length; i++) {
        element = document.createElement('a');
        dlPath = "SavedFiles/midi/"+fileDir[i];

        element.setAttribute('href', dlPath);
        element.setAttribute('download', fileDir[i]);
        element.innerHTML = fileDir[i];

        elementLI = document.createElement('li');
        element.setAttribute('class', liClass);
        elementLI.appendChild(element);

        document.getElementById('midiFiles').appendChild(elementLI);
    }
}

displayFiles();
</script>
</body>
</html>
